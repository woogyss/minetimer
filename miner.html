<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–∞–π–º–µ—Ä—ã —à–∞—Ö—Ç —Å —á–∞—Ç–æ–º</title>
    <style>
        /* –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–≤–æ–π CSS –∫–∞–∫ –µ—Å—Ç—å */
        /* –°—é–¥–∞ –≤—Å—Ç–∞–≤–∏–º —Å—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
    </style>
</head>
<body>
    <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
    <div class="login-form" id="loginForm">
        <h1>–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É</h1>
        <input type="text" id="username" placeholder="–õ–æ–≥–∏–Ω" required>
        <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" required>
        <button class="regular-btn" onclick="login()">–í–æ–π—Ç–∏</button>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div class="main-container" id="mainContainer">
        <button class="profile-btn" id="profileBtn">üë§</button>
        <div class="timers-section">
            <div class="mine-timers" id="mineTimers">
                <h1>–¢–∞–π–º–µ—Ä—ã —à–∞—Ö—Ç</h1>
                <div id="timersContainer"></div>
            </div>
        </div>
        <div class="chat-section">
            <div class="chat-container">
                <h1>–ß–∞—Ç</h1>
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                    <button class="send-btn regular-btn" onclick="sendMessage()">‚û§</button>
                </div>
                <button class="admin-btn" id="createUserBtn" onclick="showCreateUserModal()">–°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                <button class="admin-btn" id="adminControlsBtn" onclick="showEditTimersModal()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–π–º–µ—Ä—ã</button>
            </div>
        </div>
    </div>

    <div class="profile-container" id="profileContainer">
        <button class="profile-btn" id="backBtn">‚Üê</button>
        <div class="profile-content">
            <h1>–ü—Ä–æ—Ñ–∏–ª—å</h1>
            <div class="profile-info" id="profileInfo"></div>
            <button class="regular-btn" onclick="logout()">–í—ã–π—Ç–∏</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div class="modal" id="createUserModal">...</div>
    <div class="modal" id="editTimersModal">...</div>

    <script>
        let users = {};
        let currentUser = null;
        let mines = {};
        let chatMessages = [];

        function base64encode(str) {
            return btoa(str);
        }

        async function loadUsers() {
            try {
                const response = await fetch('users.json');
                users = await response.json();
            } catch (err) {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π");
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = base64encode(document.getElementById('password').value);

            if (!users[username]) {
                alert("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω");
                return;
            }

            if (users[username].password === password) {
                currentUser = {
                    username: username,
                    isAdmin: users[username].isAdmin
                };

                document.getElementById('profileBtn').textContent = username.charAt(0).toUpperCase();
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('mainContainer').classList.add('active-container');

                if (currentUser.isAdmin) {
                    document.getElementById('adminControlsBtn').style.display = 'block';
                    document.getElementById('createUserBtn').style.display = 'block';
                }

                loadData();
                updateTimers();
                updateProfileInfo();
                document.getElementById('chatInput').focus();
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å!');
            }
        }

        function logout() {
            currentUser = null;
            document.getElementById('mainContainer').classList.remove('active-container');
            document.getElementById('profileContainer').classList.remove('active-container');
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // –ó–¥–µ—Å—å –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–≤–æ–π —Å—Ç–∞—Ä—ã–π –∫–æ–¥ updateTimers, sendMessage, updateChat, formatChatTime –∏ —Ç.–¥.

        window.onload = async function() {
            await loadUsers();
            loadData();
        };
    </script>
</body>
</html>
